---
id: browser-cross-domain
slug: /browser-cross-domain
title: æµè§ˆå™¨è·¨åŸŸé—®é¢˜
date: 2024-10-22
authors: Fanceir
tags: [javascript, browser, url]
keywords: [javascript, browser, url]
---

## ä»€ä¹ˆæ˜¯è·¨åŸŸ

åœ¨å‰ç«¯ä¸­ï¼Œè·¨åŸŸæ˜¯æŒ‡æµè§ˆå™¨å…è®¸å‘æœåŠ¡å™¨å‘é€è·¨åŸŸè¯·æ±‚ï¼Œä»è€Œå¯ä»¥å®¢æœ Ajax åªèƒ½åŒæºä½¿ç”¨çš„é—®é¢˜

### åŒæºç­–ç•¥

æ‰€è°“çš„åŒæºæ˜¯æŒ‡åè®®åŸŸåç«¯å£ç›¸åŒï¼Œå³ä½¿ä¸¤ä¸ªä¸åŒçš„åŸŸåæŒ‡å‘åŒä¸€ä¸ª ip åœ°å€ä¹Ÿæ˜¯ä¸åŒæºçš„
|URL|è¯´æ˜|ç»“æœ|
|---|---|---|
https://www.baidu.com/b.js https://www.baidu.com/a.js|åè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒ|åŒæº|
www.baidu.com:80/a.js www.baidu.com/a.js|åè®®ã€åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒ|ä¸åŒæº|
http://www.baidu.com/a.js https://www.baidu.com/a.js|åè®®ä¸åŒ|ä¸åŒæº|
https://doc.baidu.com https://www.baidu.com|åŸŸåä¸åŒ|ä¸åŒæº|

### è·¨åŸŸè§£å†³æ–¹æ¡ˆ

#### JSONP è·¨åŸŸ

ä½¿ç”¨ script æ ‡ç­¾è¿›è¡Œè·¨åŸŸè¯·æ±‚ï¼Œä½†æ˜¯åªæ”¯æŒ get è¯·æ±‚
é€šè¿‡ script æ ‡ç­¾å¼•å…¥ä¸€ä¸ª js æ–‡ä»¶ï¼Œè¿™ä¸ª js æ–‡ä»¶è½½å…¥æˆåŠŸåä¼šæ‰§è¡Œæˆ‘ä»¬åœ¨ url å‚æ•°ä¸­æŒ‡å®šçš„å‡½æ•°ï¼Œå¹¶ä¸”ä¼šæŠŠæˆ‘ä»¬éœ€è¦çš„ json æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥

```html
<script>
  var script = document.createElement("script");
  script.type = "text/javascript";
  script.src =
    "http://www.example.com/login?user=admin&callback=handleCallback";
  document.head.appendChild(script);
  function handleCallback(res) {
    console.log(res);
  }
</script>
```

#### CORS è·¨åŸŸ

å¤„ç†ç®€å•çš„è·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORSï¼Œåœ¨å¤´ä¿¡æ¯ä¸­åŠ ä¸€ä¸ª Origin,Origin ä¸­çš„å°±æ˜¯æ¥è‡ªäºå“ªä¸ªæºï¼ˆåè®®+åŸŸå+ç«¯å£ï¼‰
`Access-Control-Allow-Origin`è¡¨ç¤ºå…è®¸æ¥è‡ªå“ªä¸ªå…ƒçš„è¯·æ±‚ï¼Œè¦ä¹ˆæ˜¯ `*`ï¼Œè¦ä¹ˆæ˜¯æŒ‡å®šçš„åŸŸå
å¦‚æœæ˜¯ `*`ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„åŸŸåéƒ½å¯ä»¥è®¿é—®
å¦‚æœæ˜¯æŒ‡å®šçš„åŸŸåï¼Œè¡¨ç¤ºåªæœ‰æŒ‡å®šçš„åŸŸåå¯ä»¥è®¿é—®
`Access-Control-Allow-Credentials`è¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ cookie
å¦‚æœæ˜¯ `true`ï¼Œè¡¨ç¤ºå…è®¸å‘é€ cookie
å¦‚æœæ˜¯ `false`ï¼Œè¡¨ç¤ºä¸å…è®¸å‘é€ cookie
`Access-Control-Expose-Headers`è¡¨ç¤ºå“ªäº›å¤´ä¿¡æ¯å¯ä»¥æš´éœ²ç»™å¤–éƒ¨

å¤æ‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ˜¯ PUT æˆ–è€…æ˜¯ DELETEï¼Œæˆ–è€… Content-Type æ˜¯ application/jsonï¼Œè¿™ç§è¯·æ±‚ä¼šå…ˆå‘ä¸€ä¸ªé¢„æ£€è¯·æ±‚ï¼Œé¢„æ£€è¯·æ±‚æ˜¯ä¸€ä¸ª OPTIONS è¯·æ±‚ï¼Œå¦‚æœæœåŠ¡å™¨å…è®¸ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºçœŸæ­£çš„è¯·æ±‚
è¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸è¿™ä¸ªè¯·æ±‚
`Access-Control-Request-Method`è¡¨ç¤ºè¯·æ±‚çš„æ–¹æ³•
`Access-Control-Request-Headers`è¡¨ç¤ºè¯·æ±‚å¤´ä¿¡æ¯
æœåŠ¡å™¨æ”¶åˆ°äº†é¢„æ£€è¯·æ±‚ä¹‹åæ£€æŸ¥äº†ä»¥ä¸Šè¿™äº›å­—æ®µï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ä¹‹åä¼šåšå‡ºå›åº”

#### nodejs ä»£ç 

```js
var http = require("http");
var server = http.createServer();
var qs = require("querystring");
server.on("request", function (req, res) {
  var postData = "";
  //æ•°æ®å—æ¥æ”¶
  req.addListener("data", function (postDataChunk) {
    postData += postDataChunk;
  });
  //æ•°æ®æ¥æ”¶å®Œæ¯•
  req.addListener("end", function () {
    postData = qs.parse(postData);
    res.writeHead(200, {
      "Access-Control-Allow-Origin": "http://localhost:63342",
      //å…è®¸è·¨åŸŸçš„åŸŸåï¼Œ*è¡¨ç¤ºæ‰€æœ‰åŸŸåéƒ½å¯ä»¥è·¨åŸŸ

      "Access-Control-Allow-Credentials": "true", //æ˜¯å¦å…è®¸å‘é€cookie
      "Access-Control-Expose-Headers":
        "Content-Type,Content-Length,Authorization,Accept,X-Requested-With",
      "Access-Control-Allow-Methods": "PUT,POST,GET,DELETE,OPTIONS",
      "Access-Control-Allow-Headers":
        "Content-Type,Content-Length,Authorization,Accept,X-Requested-With",
    });
    res.write(JSON.stringify(postData));
    res.end();
  });
});
```

åç»­å†…å®¹å®è·µå®Œåå†æ¥è¡¥å…… ğŸš§
